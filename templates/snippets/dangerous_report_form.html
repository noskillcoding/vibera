<!-- Reports Section matching Comments design -->
<div style="margin-top: 20px; max-width: 100%;">
    
    <details id="reports-section" style="font-size: 14px; max-width: 100%;" {% if request.GET.report_added %}open{% endif %}>
        <summary style="cursor: pointer; margin-bottom: 15px; color: #d63031;">
            Reports ({{ post.active_reports_count }})
        </summary>
        
        <div class="reports-content" style="max-width: 100%;">
        
        <!-- Existing Reports -->
        {% if post.dangerous_reports.all %}
            <div class="reports-list" style="margin: 20px 0;">
                {% for report in post.dangerous_reports.all %}
                    <div style="margin: 4px 0; padding: 2px 0; border-left: 2px solid {% if report.deleted %}rgba(128,128,128,0.4){% else %}#d63031{% endif %}; padding-left: 6px;">
                        <div style="font-size: 0.9em; opacity: 0.8; display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>{{ report.display_name }}</strong> â€¢ {{ report.created_at|date:"M d, Y H:i" }}</span>
                            {% if not report.deleted and report.user == request.user and user_latest_report and report.id == user_latest_report.id %}
                                <form method="post" action="{% url 'delete_report' uid=post.uid %}" style="display: inline;" onsubmit="return confirm('Delete this report?');">
                                    {% csrf_token %}
                                    <button type="submit" style="background: #dc3545; color: white; border: none; cursor: pointer; font-size: 10px; padding: 2px 6px; border-radius: 2px;" title="Delete most recent report">
                                        Delete
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                        <div style="{% if report.deleted %}font-style: italic; opacity: 0.6;{% else %}color: #d63031;{% endif %}">
                            {% if report.deleted %}
                                This report was deleted by its author
                            {% else %}
                                {{ report.comment }}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        <!-- Report Form -->
        {% if user.is_authenticated %}
            {% if not user_has_reported %}
                <div class="report-form" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; max-width: 100%; box-sizing: border-box;">
                    <h4 style="color: #d63031;">Report Dangerous Content</h4>
                    <form action="{% url 'report_dangerous' uid=post.uid %}" method="post" style="max-width: 100%;">
                        {% csrf_token %}
                        
                        <div style="margin: 10px 0;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Reporter name:</label>
                            
                            {% if user.settings.nickname %}
                            <div style="margin: 5px 0;">
                                <label>
                                    <input type="radio" name="display_option" value="nickname" style="margin-right: 5px;" {% if preview %}disabled{% else %}checked{% endif %}>
                                    Use nickname: <strong>{{ user.settings.nickname }}</strong>
                                </label>
                            </div>
                            <div style="margin: 5px 0;">
                                <label>
                                    <input type="radio" name="display_option" value="email" style="margin-right: 5px;" {% if preview %}disabled{% endif %}>
                                    Use email: {{ user.email }}
                                </label>
                            </div>
                            {% else %}
                            <div style="margin: 5px 0;">
                                <label>
                                    <input type="radio" name="display_option" value="email" style="margin-right: 5px;" {% if preview %}disabled{% else %}checked{% endif %}>
                                    Use email: {{ user.email }} <span style="font-size: 0.9em; color: #666;">(you can <a href="{% url 'user_account_settings' %}" target="_blank" style="color: #007cba; text-decoration: underline;">set up a nickname</a> to use instead of your email address)</span>
                                </label>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <textarea id="comment" name="comment" {% if not preview %}required{% endif %} minlength="5" maxlength="100" rows="3"
                                      style="width: 100%; max-width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical; box-sizing: border-box; {% if preview %}background-color: #f5f5f5; opacity: 0.7;{% endif %}"
                                      {% if preview %}disabled placeholder="Reporting is disabled in preview mode"{% else %}placeholder="Why is this post dangerous? (5-100 characters)"{% endif %}></textarea>
                        </div>
                        
                        <button type="submit" {% if preview %}disabled{% endif %} style="background: {% if preview %}#ccc{% else %}#d63031{% endif %}; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: {% if preview %}not-allowed{% else %}pointer{% endif %};">
                            {% if preview %}Reporting Disabled (Preview){% else %}Submit Report{% endif %}
                        </button>
                    </form>
                </div>
            {% else %}
                <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; color: #666; text-align: center;">
                    <p>{% if preview %}<span style="opacity: 0.6;">Preview mode: </span>{% endif %}You have already reported this post.</p>
                </div>
            {% endif %}
        {% else %}
            <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; color: #666;">
                <p>{% if preview %}<span style="opacity: 0.6;">Preview mode: </span>{% endif %}<a href="/accounts/login/" {% if preview %}style="opacity: 0.6; pointer-events: none;"{% endif %}>Log in</a> to report dangerous content.</p>
            </div>
        {% endif %}
        </div>
    </details>
</div>

{% if request.GET.report_added %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Scroll to reports section after successful submission
    const reportsSection = document.getElementById('reports-section');
    if (reportsSection) {
        reportsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
});
</script>
{% endif %}