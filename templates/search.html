{% extends 'base.html' %}
{% load custom_tags %}

{% block title %}Search | Bear Blog{% endblock %}

{% block custom_styles %}
    {% include 'styles/blog/default.css' %}
    {% include 'styles/dashboard.css' %}
    {% if user.is_authenticated and user.settings.discover_styles %}
    {{ user.settings.discover_styles | safe }}
    {% endif %}
{% endblock %}

{% block seo %}
<meta name="robots" content="nofollow">
{% include 'snippets/seo_tags.html' with site_name='ʕ•ᴥ•ʔ Bear Blog' type="website" title='Search Results' url='https://bearblog.dev/search' description='Search results on Bear Blog' image="https://bear-images.sfo2.cdn.digitaloceanspaces.com/herman-1683556668-0.png" %}
{% endblock %}

{% block nav %}
{% endblock %}

{% block content %}
<h1>
    Search
</h1>
<nav>
    <a href="/discover/">Trending</a>
    <a href="/discover/?newest=true">Most recent</a>
    <b><a href="/discover/search/">Search</a></b>
    
</nav>

<!-- Enhanced Filter Panel -->
<p>
    <details id="filters-panel" style="font-size: small; color: grey;" {% if selected_tags or selected_tools %}open{% endif %}>
        <summary>
            Filters: Tags ({{ selected_tags|length }}) Tools ({{ selected_tools|length }})
        </summary>
        <hr>
        
        <!-- Tags Section -->
        <div style="margin: 10px 0;">
            <strong style="color: #007cba;">Tags:</strong>
            {% for tag in selected_tags %}
                <span style="display: inline-block; background: #007cba; color: white; padding: 2px 8px; border-radius: 12px; margin: 2px; font-size: 0.85em;">
                    #{{ tag }}
                    <a href="?{% if search_string %}query={{ search_string }}&{% endif %}{% for t in selected_tags %}{% if t != tag %}tags={{ t }}&{% endif %}{% endfor %}{% for tool in selected_tools %}tools={{ tool }}&{% endfor %}" style="color: white; text-decoration: none; margin-left: 4px;">×</a>
                </span>
            {% endfor %}
            <form method="GET" style="display: inline-block; margin-left: 8px;">
                {% if search_string %}<input type="hidden" name="query" value="{{ search_string }}">{% endif %}
                {% for tag in selected_tags %}<input type="hidden" name="tags" value="{{ tag }}">{% endfor %}
                {% for tool in selected_tools %}<input type="hidden" name="tools" value="{{ tool }}">{% endfor %}
                <input type="text" name="tags" placeholder="Add tag..." style="padding: 2px 4px; font-size: 12px; width: 100px;">
                <button type="submit" style="padding: 2px 6px; font-size: 11px;">+</button>
            </form>
            <br>
            Popular: 
            {% for tag in popular_tags %}
            <a href="?{% if search_string %}query={{ search_string }}&{% endif %}{% for t in selected_tags %}tags={{ t }}&{% endfor %}{% for tool in selected_tools %}tools={{ tool }}&{% endfor %}tags={{ tag }}" style="color: #007cba; text-decoration: none; margin-right: 8px; font-size: 0.85em;">#{{ tag }}</a>
            {% endfor %}
            <br><br>
        </div>
        
        <!-- Tools Section -->
        <div style="margin: 10px 0;">
            <strong style="color: #666;">Tools:</strong>
            {% for tool in selected_tools %}
                <span style="display: inline-block; background: #666; color: white; padding: 2px 8px; border-radius: 12px; margin: 2px; font-size: 0.85em;">
                    {{ tool }}
                    <a href="?{% if search_string %}query={{ search_string }}&{% endif %}{% for tag in selected_tags %}tags={{ tag }}&{% endfor %}{% for t in selected_tools %}{% if t != tool %}tools={{ t }}&{% endif %}{% endfor %}" style="color: white; text-decoration: none; margin-left: 4px;">×</a>
                </span>
            {% endfor %}
            <form method="GET" style="display: inline-block; margin-left: 8px;">
                {% if search_string %}<input type="hidden" name="query" value="{{ search_string }}">{% endif %}
                {% for tag in selected_tags %}<input type="hidden" name="tags" value="{{ tag }}">{% endfor %}
                {% for tool in selected_tools %}<input type="hidden" name="tools" value="{{ tool }}">{% endfor %}
                <input type="text" name="tools" placeholder="Add tool..." style="padding: 2px 4px; font-size: 12px; width: 100px;">
                <button type="submit" style="padding: 2px 6px; font-size: 11px;">+</button>
            </form>
            <br>
            Popular: 
            {% for tool in popular_tools %}
            <a href="?{% if search_string %}query={{ search_string }}&{% endif %}{% for tag in selected_tags %}tags={{ tag }}&{% endfor %}{% for t in selected_tools %}tools={{ t }}&{% endfor %}tools={{ tool }}" style="color: #666; text-decoration: none; margin-right: 8px; font-size: 0.85em;">{{ tool }}</a>
            {% endfor %}
            <br>
        </div>
        
        {% if selected_tags or selected_tools %}
        <a href="{% if search_string %}?query={{ search_string }}{% else %}?{% endif %}" style="color: #dc3545; text-decoration: none; font-size: 0.9em;">Clear all filters</a>
        {% endif %}
        <hr>
    </details>
</p>

<p>
    <form method="POST">
        {% csrf_token %}
        <input type="text" name="query" placeholder="Search..." value="{{ search_string }}">
        <input type="submit">
    </form>
</p>
<ul class="discover-posts">
    {% for post in posts %}
    <li>
        <div>
            <span style="white-space: nowrap;">
                <a href="{{ post.blog.dynamic_useful_domain }}/{{ post.slug }}">{{ post.title }}</a>{% if post.tags or post.tools %} <span style="margin: 0 8px; opacity: 0.6; font-weight: 300;">|</span> <span style="font-size: 0.85em;">{% if post.tags %}{% for tag in post.tags %}{% if forloop.counter <= 3 %}<a href="?{% if search_string %}query={{ search_string }}&{% endif %}{% for t in selected_tags %}tags={{ t }}&{% endfor %}{% for tool in selected_tools %}tools={{ tool }}&{% endfor %}tags={{ tag }}" style="color: #007cba; text-decoration: none; margin-right: 8px; cursor: pointer; opacity: 0.8;" title="Add tag filter" onmouseover="this.style.opacity='1'; this.style.textDecoration='underline'" onmouseout="this.style.opacity='0.8'; this.style.textDecoration='none'">#{{ tag }}</a>{% endif %}{% endfor %}{% endif %}{% if post.tools %}{% for tool in post.tools %}{% if forloop.counter <= 2 %}<a href="?{% if search_string %}query={{ search_string }}&{% endif %}{% for t in selected_tags %}tags={{ t }}&{% endfor %}{% for t in selected_tools %}tools={{ t }}&{% endfor %}tools={{ tool }}" style="color: #666; text-decoration: none; margin-right: 8px; cursor: pointer; opacity: 0.8;" title="Add tool filter" onmouseover="this.style.opacity='1'; this.style.textDecoration='underline'" onmouseout="this.style.opacity='0.8'; this.style.textDecoration='none'">{{ tool }}</a>{% endif %}{% endfor %}{% endif %}</span>{% endif %}
            </span>
            <small>(<a href="{{ post.blog.dynamic_useful_domain }}">{{ post.blog.useful_domain }}</a>)</small>
            {% if post.short_description %}
            <div style="margin: 4px 0; color: #666; font-size: 14px;">
                {{ post.short_description }}
            </div>
            {% endif %}
            <small>
                <small>Published {{ post.published_date|timesince }} ago</small>
                <small>
                    <svg style="height:16px;margin: 0 -8px -4px 0;" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><polyline points="17 11 12 6 7 11"></polyline><polyline points="17 18 12 13 7 18"></polyline></svg>
                    {{ post.upvotes }}
                </small>
            </small>
        </div>

    </li>
    {% empty %}
    <li>
        ┬┴┬┴┤•ᴥ•ʔ├┬┴┬┴
    </li>
    {% endfor %}
</ul>
{% endblock %}

{% block footer %}
<p>
    Start your own blog with <a href="/accounts/signup/">ʕ•ᴥ•ʔ Bear</a>
</p>
{% endblock %}