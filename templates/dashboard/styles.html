{% extends 'base.html' %}

{% block title %}Styling | Bear Blog {% endblock %}

{% block custom_styles %}
    {% include 'styles/blog/default.css' %}
    {% include 'styles/dashboard.css' %}
    {{ request.user.settings.dashboard_styles | safe }}
{% endblock %}

{% block nav %}{% include '../snippets/dashboard_nav.html' %}{% endblock %}

{% block content %}
<h1>Themes</h1>

{% for style in stylesheets %}
<details style="margin-bottom: 15px;">
    <summary style="cursor: default; list-style: none;" onclick="return false;">
        <ul class="post-list" style="margin: 0;">
            <li style="justify-content: space-between;">
                <div style="display: flex; align-items: baseline;">
                    <span class="number">{{ forloop.counter }}.</span>
                    <span style="font-size: 14px;">{% if style.title %}{{ style.title }}{% else %}{{ style.identifier|title }}{% endif %} <span style="font-size: 10px; cursor: pointer; padding: 1px 3px;" onclick="event.stopPropagation(); toggleDetails(this)">▼</span></span>
                </div>
                <small style="display: flex; gap: 5px;">
                    <form method="get" action="{% url 'styles' id=blog.subdomain %}" style="display:inline;" target="_blank">
                        <input type="hidden" name="stylesheet" value="{{ style.identifier }}">
                        <input type="hidden" name="preview" value="true">
                        <button type="submit" onclick="event.stopPropagation()">Preview</button>
                    </form>
                    <form method="post" action="{% url 'styles' id=blog.subdomain %}" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="stylesheet" value="{{ style.identifier }}">
                        <button type="submit" onclick="event.stopPropagation(); return confirm('This will overwrite your current styles, are you sure?')">Apply</button>
                    </form>
                </small>
            </li>
        </ul>
    </summary>
    
    <div style="margin-left: 50px; margin-top: 5px;">
        <p style="font-size: 12px; margin: 5px 0; font-weight: bold;">Theme Characteristics:</p>
        <ul style="font-size: 12px; margin: 0; padding: 0; list-style: none;">
            <li><strong>Name:</strong> {% if style.title %}{{ style.title }}{% else %}{{ style.identifier|title }}{% endif %}</li>
            <li><strong>Identifier:</strong> {{ style.identifier }}</li>
            {% if style.css %}
                {% if 'Georgia' in style.css %}
                    <li><strong>Font:</strong> Georgia serif (literary feel)</li>
                {% elif 'Fira' in style.css %}
                    <li><strong>Font:</strong> Fira Code monospace (developer theme)</li>
                {% elif 'system-ui' in style.css %}
                    <li><strong>Font:</strong> System UI (clean, native feel)</li>
                {% else %}
                    <li><strong>Font:</strong> Verdana, sans-serif (default)</li>
                {% endif %}
                
                {% if '--width: 900px' in style.css %}
                    <li><strong>Layout:</strong> Wider than default (900px)</li>
                {% elif '--width: 800px' in style.css %}
                    <li><strong>Layout:</strong> Standard width (800px)</li>
                {% elif '--width: 720px' in style.css %}
                    <li><strong>Layout:</strong> Narrow width (720px)</li>
                {% else %}
                    <li><strong>Layout:</strong> Responsive width</li>
                {% endif %}
                
                {% if '#fefefe' in style.css or '#f8f8f8' in style.css %}
                    <li><strong>Colors:</strong> Warm off-white background with dark text</li>
                {% elif '#01242e' in style.css %}
                    <li><strong>Colors:</strong> Cool blue background with light text</li>
                {% elif '#1f1b1b' in style.css %}
                    <li><strong>Colors:</strong> Warm brown background with light text</li>
                {% else %}
                    <li><strong>Colors:</strong> Default color scheme</li>
                {% endif %}
                
                {% if '--font-scale: 1.3em' in style.css %}
                    <li><strong>Typography:</strong> Larger text (1.3em){% if 'font-style: italic' in style.css %}, italic headings{% endif %}</li>
                {% elif '--font-scale: 1em' in style.css %}
                    <li><strong>Typography:</strong> Standard text size (1em)</li>
                {% else %}
                    <li><strong>Typography:</strong> Custom text sizing</li>
                {% endif %}
                
                {% if 'prefers-color-scheme: dark' in style.css %}
                    <li><strong>Dark Mode:</strong> {% if '#1f1b1b' in style.css %}Warm brown/beige dark theme{% elif '#01242e' in style.css %}Cool blue dark theme{% else %}Supported{% endif %}</li>
                {% else %}
                    <li><strong>Dark Mode:</strong> Not supported</li>
                {% endif %}
            {% else %}
                <li><em>Theme characteristics not available</em></li>
            {% endif %}
        </ul>
    </div>
</details>

{% empty %}
<ul class="post-list">
    <li>
        No themes available
    </li>
</ul>
{% endfor %}

<form method="POST" class="post-form full-width">
  <p class="sticky-controls">
    <span>
      <button type="submit" class="save btn btn-default">Publish</button>
      <button onclick="event.preventDefault();window.open('{{ blog.dynamic_useful_domain }}');">
        View
      </button>
    </span>
  </p>
  {% csrf_token %} {{ form.as_p }}
</form>

{% if blog.codemirror_enabled %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/codemirror.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/codemirror.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/css/css.min.js"></script>
<style>
	.CodeMirror {
		height: unset;
    background-color: #eceff4;
    border: none;
    outline: none;
    border-top: 0;
		padding: 10px;
    min-height: 200px;
	}
</style>
<script>
  var codemirror = CodeMirror.fromTextArea(document.querySelector('textarea'), {mode: "css"})

  setTimeout(() => {
    window.scrollTo(0, sessionStorage.getItem('scrollY'))
  }, 10)
  

	window.addEventListener("scroll", function(event) {
		sessionStorage.setItem('scrollY', window.scrollY)
	})

  const preview = name => {
    window.open('?preview=True&style=' + name)
  }
  
  function toggleDetails(arrow) {
    const details = arrow.closest('details');
    if (details.open) {
      details.removeAttribute('open');
      arrow.textContent = '▼';
    } else {
      details.setAttribute('open', '');
      arrow.textContent = '▲';
    }
  }
</script>
{% endif %}

<script>
  function toggleDetails(arrow) {
    event.preventDefault();
    event.stopPropagation();
    const details = arrow.closest('details');
    if (details.open) {
      details.removeAttribute('open');
      arrow.textContent = '▼';
    } else {
      details.setAttribute('open', '');
      arrow.textContent = '▲';
    }
  }
</script>

{{ request.user.settings.dashboard_footer | safe }}

{% endblock %}
