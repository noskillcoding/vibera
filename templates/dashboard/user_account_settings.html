{% extends 'base.html' %}

{% block title %}Account Settings | Bear Blog{% endblock %}

{% block custom_styles %}
    {% include 'styles/blog/default.css' %}
    {% include 'styles/dashboard.css' %}
    {{ request.user.settings.dashboard_styles | safe }}
{% endblock %}

{% block nav %}{% include '../snippets/dashboard_nav.html' %}{% endblock %}

{% block content %}
<h1>Account Settings</h1>

{% if success_message %}
<div style="background: #d4edda; color: #155724; padding: 10px; border-radius: 4px; margin: 15px 0;">
    {{ success_message }}
</div>
{% endif %}

{% if error_message %}
<div style="background: #f8d7da; color: #721c24; padding: 10px; border-radius: 4px; margin: 15px 0;">
    {{ error_message }}
</div>
{% endif %}

<div style="max-width: 500px;">
    <form method="POST">
        {% csrf_token %}
        
        <h2>Display Name Settings</h2>
        
        <p>
            <label for="nickname">Nickname</label>
            <br>
            {% if user_settings.nickname %}
                <input type="text" 
                       value="{{ user_settings.nickname }}" 
                       disabled
                       style="max-width: 300px; background: #f5f5f5; color: #666;"/>
                <br>
                <small style="color: #666;">
                    <strong>Note:</strong> Your nickname cannot be changed once set. This is permanent.
                </small>
            {% else %}
                <input type="text" 
                       name="nickname" 
                       placeholder="Enter a nickname..." 
                       maxlength="30"
                       style="max-width: 300px;"/>
                <br>
                <small style="color: #666;">
                    <strong>Warning:</strong> You can only set your nickname once. It cannot be changed later.<br>
                    Use 2-30 characters. Letters, numbers, hyphens (-), and underscores (_) only.
                </small>
            {% endif %}
        </p>
        
        {% if not user_settings.nickname %}
        <p>
            <button type="submit">Set Nickname</button>
        </p>
        {% endif %}
        
    </form>
</div>

        <hr style="margin: 30px 0;">
        
        <h2>Account Management</h2>
        
        <p>
            <a href="{% url 'dashboard_customisation' %}">Customise dashboard</a>
        </p>
        
        <p>
            <a href="/accounts/email/">Update email address</a>
        </p>
        
        <p>
            <a href="/accounts/password/change/">Change password</a>
        </p>
        
        {% if subscription_link %}
        <hr style="margin: 30px 0;">
        <h2>Subscription</h2>
        
        <p>
            You're currently on a <b>{{ variant }}</b> subscription.
            <br>
            Upgrade to
            {% if variant == "Monthly" and upgrade_subscription_link %}
            <a href="{{ upgrade_subscription_link }}" target="_blank">Yearly</a>
            (2 months free) or {% endif %}
            <a href="https://docs.bearblog.dev/upgrading-from-subscription-to-lifetime/" target="_blank">Lifetime</a>
            (once-off purchase).  
        </p>
        <p>
            <a href="{{ subscription_link }}" target="_blank">Manage subscription</a>
        </p>
        {% endif %}
        
        <hr style="margin: 30px 0;">
        
        <h2>Account Actions</h2>
        
        <p>
            <a href="{% url 'account_logout' %}">Sign out</a>
        </p>
        
        <p>
            {% if subscription_link and not subscription_cancelled %}
            <a onclick="alert('Please cancel your subscription before deleting your account.')">Delete account</a>
            {% else %}
            <a href="{% url 'user_delete' %}">Delete account</a>
            {% endif %}
        </p>
        
    </div>

{% endblock %}